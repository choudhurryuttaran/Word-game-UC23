<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Secret Word - Online</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            --card-bg: #ffffff;
            --primary: #10ac84;
            --primary-dark: #0d8c6c;
            --accent: #ff6b6b;
            --text: #2d3436;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-card {
            background: var(--card-bg);
            width: 100%;
            max-width: 450px;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
        }

        .hidden { display: none !important; }
        input { width: 100%; padding: 15px; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem;}
        button { width: 100%; padding: 15px; border: none; border-radius: 10px; background: var(--primary); color: white; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 5px;}
        button:hover { background: var(--primary-dark); }
        .btn-danger { background: var(--accent); }
        .btn-secondary { background: #b2bec3; }

        /* LISTS */
        ul { list-style: none; padding: 0; text-align: left; margin: 20px 0; max-height: 200px; overflow-y: auto;}
        li { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .del { color: var(--accent); font-weight: bold; cursor: pointer; padding: 0 10px;}

        /* ANIMATION */
        .screen { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="game-card">
        
        <div id="loginScreen" class="screen">
            <h1>Secret Word</h1>
            <p>Enter a Room Name to join or create a group.</p>
            <input type="text" id="roomInput" placeholder="Ex: FamilyGame" style="text-align:center; font-weight:bold; letter-spacing:1px;">
            <button onclick="joinRoom()">Enter Room</button>
        </div>

        <div id="setupScreen" class="screen hidden">
            <h2 id="roomTitle">Room: ...</h2>
            <div id="loadingSpinner" class="loader"></div>
            
            <div class="input-group">
                <form onsubmit="event.preventDefault(); addPlayerDB();" style="display:flex; gap:10px;">
                    <input type="text" id="newName" placeholder="Player Name" autocomplete="off">
                    <button type="submit" style="width:auto;">+</button>
                </form>
            </div>

            <ul id="playerList"></ul>

            <button class="btn-secondary" onclick="clearRoomDB()">Clear List üóëÔ∏è</button>

            <div style="background:#f1f2f6; padding:15px; border-radius:10px; margin: 20px 0;">
                <div style="display:flex; gap:5px;">
                    <div><label>Cons.</label><input type="number" id="nCon" value="2"></div>
                    <div><label>Libs.</label><input type="number" id="nLib" value="2"></div>
                    <div><label>Blind</label><input type="number" id="nBlind" value="1"></div>
                </div>
            </div>

            <button onclick="startGame()">Start Game üöÄ</button>
        </div>

        <div id="passScreen" class="screen hidden">
            <h3>Pass Phone To</h3>
            <h1 id="passName" style="font-size:2.5rem; color:var(--primary);">Name</h1>
            <button onclick="reveal()">Reveal Secret</button>
        </div>

        <div id="revealScreen" class="screen hidden">
            <h3>Your Secret</h3>
            <div style="padding:20px; background:#f8f9fa; border-radius:10px; margin:20px 0;">
                <h1 id="secretWord" style="color:var(--primary); font-size:2.5rem; margin:0;">...</h1>
                <p id="roleDesc"></p>
            </div>
            <button onclick="nextPass()">Hide & Next</button>
        </div>

        <div id="voteScreen" class="screen hidden">
            <h1>Voting Phase</h1>
            <div id="voteList"></div>
        </div>

        <div id="blindScreen" class="screen hidden">
            <h1 style="color:var(--accent);">CAUGHT!</h1>
            <p>You are Mr. Blind! Guess the Conservative word to win.</p>
            <input type="text" id="guessInput" placeholder="Guess word...">
            <button class="btn-danger" onclick="checkWin()">Submit Guess</button>
        </div>

        <div id="endScreen" class="screen hidden">
            <h1 id="endTitle">Game Over</h1>
            <p id="endReason"></p>
            <button onclick="location.reload()">Play Again</button>
        </div>

    </div>

    <script>
        // ==========================================
        // 1. PASTE YOUR FIREBASE CONFIG HERE
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyBmqRaHVbfj25YFNCYJRrjJVtdbwNCVzJg",
            authDomain: "word-game-uc23.firebaseapp.com",
            databaseURL: "https://word-game-uc23-default-rtdb.firebaseio.com",
            projectId: "word-game-uc23",
            storageBucket: "word-game-uc23.firebasestorage.app",
            messagingSenderId: "418975857526",
            appId: "1:418975857526:web:469299cf1dff8d5dd39857",
            measurementId: "G-YWGBRG158B"
        };
        // ==========================================

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();
        
        let currentRoom = "";
        let players = [];
        let activePlayers = [];
        let turnIndex = 0;
        let targetWord = "";
        
        // --- DATA ---
        const pairs = [
            { c: "Coffee", l: "Tea" }, { c: "Bread", l: "Toast" },
            { c: "Apple", l: "Orange" }, { c: "Beach", l: "Pool" },
            { c: "Train", l: "Subway" }, { c: "Laptop", l: "Tablet" },
            { c: "Dog", l: "Cat" }, { c: "Sun", l: "Moon" }
        ];

        // --- FIREBASE LOGIC ---

        function joinRoom() {
            const room = document.getElementById('roomInput').value.trim().toUpperCase();
            if(!room) return alert("Enter a room name");
            
            currentRoom = room;
            document.getElementById('roomTitle').innerText = "Room: " + room;
            
            showScreen('setupScreen');
            document.getElementById('loadingSpinner').style.display = "block";

            // Listen for changes in this room
            db.ref('rooms/' + currentRoom).on('value', (snapshot) => {
                document.getElementById('loadingSpinner').style.display = "none";
                const data = snapshot.val();
                
                players = []; // Reset local list
                const listEl = document.getElementById('playerList');
                listEl.innerHTML = "";

                if(data) {
                    // Convert Firebase object to array
                    Object.keys(data).forEach(key => {
                        players.push({ id: key, name: data[key].name });
                        
                        // Add to UI
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span>${data[key].name}</span>
                            <span class="del" onclick="removePlayerDB('${key}')">√ó</span>
                        `;
                        listEl.appendChild(li);
                    });
                } else {
                    listEl.innerHTML = "<li style='color:#ccc; justify-content:center;'>No players yet</li>";
                }
            });
        }

        function addPlayerDB() {
            const name = document.getElementById('newName').value.trim();
            if(name) {
                // Push to Firebase
                db.ref('rooms/' + currentRoom).push({
                    name: name
                });
                document.getElementById('newName').value = "";
            }
        }

        function removePlayerDB(key) {
            // Remove from Firebase
            db.ref('rooms/' + currentRoom + '/' + key).remove();
        }

        function clearRoomDB() {
            if(confirm("Delete all players in this room?")) {
                db.ref('rooms/' + currentRoom).remove();
            }
        }

        // --- GAME LOGIC (Local on the host phone) ---
        
        function startGame() {
            const nCon = parseInt(document.getElementById('nCon').value);
            const nLib = parseInt(document.getElementById('nLib').value);
            const nBlind = parseInt(document.getElementById('nBlind').value);

            if(players.length < 3) return alert("Need 3+ players");
            if(nCon + nLib + nBlind !== players.length) return alert("Roles must match player count");

            // Setup Roles
            const p = pairs[Math.floor(Math.random()*pairs.length)];
            targetWord = p.c;
            
            let deck = [];
            for(let i=0; i<nCon; i++) deck.push({ role: 'Conservative', word: p.c });
            for(let i=0; i<nLib; i++) deck.push({ role: 'Liberal', word: p.l });
            for(let i=0; i<nBlind; i++) deck.push({ role: 'Mr. Blind', word: null });
            
            deck.sort(() => Math.random() - 0.5);

            // Fix Blind First
            if(deck[0].role === 'Mr. Blind') {
                const s = deck.findIndex(x => x.role !== 'Mr. Blind');
                [deck[0], deck[s]] = [deck[s], deck[0]];
            }

            // Shuffle Players for Turn Order
            let shuffledNames = [...players].sort(() => Math.random() - 0.5);

            activePlayers = shuffledNames.map((p, i) => ({
                name: p.name,
                role: deck[i].role,
                word: deck[i].word
            }));

            turnIndex = 0;
            showScreen('passScreen');
            updatePass();
        }

        function updatePass() {
            document.getElementById('passName').innerText = activePlayers[turnIndex].name;
        }

        function reveal() {
            const p = activePlayers[turnIndex];
            const wb = document.getElementById('secretWord');
            const rd = document.getElementById('roleDesc');

            if(p.role === 'Mr. Blind') {
                wb.innerHTML = "<span style='color:var(--accent)'>MR. BLIND</span>";
                rd.innerText = "You have no word. Blend in!";
            } else {
                wb.innerText = p.word;
                rd.innerText = "Memorize this word.";
            }
            showScreen('revealScreen');
        }

        function nextPass() {
            turnIndex++;
            if(turnIndex >= activePlayers.length) {
                renderVote();
                showScreen('voteScreen');
            } else {
                updatePass();
                showScreen('passScreen');
            }
        }

        function renderVote(status="") {
            const div = document.getElementById('voteList');
            div.innerHTML = status ? `<p style="background:#ffeaa7; padding:10px; border-radius:5px;">${status}</p>` : "";
            
            activePlayers.forEach((p, idx) => {
                const btn = document.createElement('button');
                btn.style.background = "white";
                btn.style.color = "var(--text)";
                btn.style.border = "2px solid #eee";
                btn.style.marginTop = "10px";
                btn.innerHTML = `Vote Out <b>${p.name}</b>`;
                btn.onclick = () => processVote(idx);
                div.appendChild(btn);
            });
        }

        function processVote(idx) {
            const victim = activePlayers[idx];
            if(victim.role === 'Mr. Blind') return showScreen('blindScreen');

            activePlayers.splice(idx, 1);
            
            const cons = activePlayers.filter(p => p.role === 'Conservative').length;
            const libs = activePlayers.filter(p => p.role === 'Liberal').length;

            if(cons === 1 && libs > cons) {
                endGame("Conservative Defeat", "Liberals have the majority!");
            } else {
                renderVote(`${victim.name} was a <b>${victim.role}</b>`);
            }
        }

        function checkWin() {
            const guess = document.getElementById('guessInput').value.toLowerCase();
            if(guess === targetWord.toLowerCase()) endGame("Mr. Blind Wins!", "Correct guess!");
            else endGame("Civilians Win!", `Wrong guess. Word was ${targetWord}`);
        }

        function endGame(title, msg) {
            document.getElementById('endTitle').innerText = title;
            document.getElementById('endReason').innerHTML = msg;
            showScreen('endScreen');
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

    </script>
</body>
</html>

